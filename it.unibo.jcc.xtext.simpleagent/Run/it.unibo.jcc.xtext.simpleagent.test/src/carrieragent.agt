Agent carrieragent ip [host="localhost" port=8042] -mqtt

System {
	mqttBroker "localhost" : 1883
	
    Context ctxDummyForGotoBehavior   ip [host="otherresourcelocalhost" port=8035]   -mqtt
    Context ctxDummyForRoomState   ip [host="otherresourcelocalhost" port=8038]   -mqtt
}

ExternalBehavior gotobehavior context ctxDummyForGotoBehavior // TODO Behaviors as actors (check name consistency internal/external)
ExternalBehavior roomstate context ctxDummyForRoomState

Behavior carrier planner itunibo.jcc.^planner.adapter.^CarrierPlannerAdapter {
	
	init {
		// Set up planner according to the state of the room (subsequent updates will be done explicitly - for now)
		run itunibo.jcc.coap.roomstate.carrierRoomStateClient.create(myself, ^planner)
		run itunibo.jcc.coap.roomstate.carrierRoomStateClient.initPlanner()
	}
	
	// TODO Update roomstate!
	
	action take(Item) {
		println("carrier taking ${payloadArg(0)}")
//		["planner.take(\"${payloadArg(0)}\"/*, \"butler\")*/"]
		["planner.take(\"${payloadArg(0)}\")"]
	}
	
	action put(Item,Location) {
		println("carrier putting ${payloadArg(0)} in ${payloadArg(1)}")
		["planner.put(\"${payloadArg(0)}\", \"${payloadArg(1)}\")"]
	}
	
	action goto(L) {
		forward gotobehavior -m ^setGoal : ^setGoal(goto($payloadArg(0)))
//		["planner.update(\"butler\", \"${payloadArg(0)}\")"]
		["planner.goto(\"${payloadArg(0)}\")"]
	}
	// TODO Currently done "by hand", automatize
	onEffect(suspend) {
		forward gotobehavior -m suspend : suspend
	}
	retry when "true" // TODO Syntax with no condition
	onEffect(resume) {
		forward gotobehavior -m resume : resume
	}
	retry when "true" // TODO Syntax with no condition
	onEffect(goalReached) { // TODO Workaround
		println("carrier: subgoal reached")
	}
	
	onGoalReached {
		println("carrierbehavior: onGoalReached")
	}
	
//	onSuspended {
//		forward movebehavior -m suspend : suspend
//	}
	
//	onResumed {
//		forward movebehavior -m resume : resume
//	}
}